# Private Liquid Staking Protocol

**Live Demo:** [https://private-liquid-staking.netlify.app](https://private-liquid-staking.netlify.app)

> **Hack4Privacy Hackathon** - iExec x 50Partners

Confidential Liquid Staking Protocol built with iExec TEE (Trusted Execution Environment) for the Hack4Privacy hackathon.

## Problem

Traditional liquid staking protocols expose user positions publicly:
- **Whale tracking**: Large stakers are identified and targeted
- **Front-running**: Unstake requests are exploited by MEV bots
- **Privacy breach**: Portfolio composition is visible to everyone

## Solution

Private Liquid Staking uses iExec's Confidential Computing to:
- **Hide stake amounts**: Positions are encrypted, only commitments are on-chain
- **Confidential rewards**: Reward calculations happen inside TEE
- **Private unstaking**: Unstake requests processed without revealing amounts

## Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                    FRONTEND (React)                         │
└─────────────────────┬───────────────────────────────────────┘
                      │
┌─────────────────────▼───────────────────────────────────────┐
│              SMART CONTRACTS (Arbitrum)                     │
│  - PrivateStaking.sol : stake/unstake with commitments      │
│  - PLSToken.sol : Private Liquid Staking Token (LST)        │
└─────────────────────┬───────────────────────────────────────┘
                      │
┌─────────────────────▼───────────────────────────────────────┐
│                  iApp TEE (iExec)                           │
│  - Confidential reward computation                          │
│  - Stake verification without revealing amounts             │
│  - Proof generation for claims                              │
└─────────────────────────────────────────────────────────────┘
```

## Features

### Privacy-Preserving Technology
- **iExec TEE Integration**: Confidential computations in Trusted Execution Environments
- **Commitment Scheme**: Stake amounts hidden using cryptographic commitments
- **Zero-Knowledge Proofs**: Verify rewards without revealing positions

### Advanced Capabilities
- **Account Abstraction**: Gasless transactions using Biconomy (ERC-4337)
- **Bulk Processing**: Process multiple stakes in single TEE task for efficiency
- **Real-time Rewards**: Dynamic APY based on total value locked

### User Experience
- **Modern UI**: React + TailwindCSS with responsive design
- **Wallet Integration**: MetaMask and compatible Web3 wallets
- **Transaction History**: Track all staking activities
- **Privacy Toggle**: Compare private vs public staking

## Deployed Contracts

The protocol is deployed on **Arbitrum One** (mainnet) and **iExec Arbitrum Sepolia** (testnet):

**Arbitrum One (Mainnet):**
- **PLSToken**: `0x39b067f91a3cd342d7055cf832983c1f4e6a9f77`
- **PrivateStaking**: `0x67ec0d5d810b3e2e402140f90cb8ce3a473baaae`
- **Staking Asset (WETH)**: `0x82aF49447D8a07e3bd95BD0d56f35241523fBab1`

**iExec Arbitrum Sepolia Testnet (TEE)**
- **iApp Address**: `0xB9B3BBB3208D8fCF4571e6571b559E4B372795b8`
- **Docker Image**: `docker.io/ywayleyy/private-liquid-staking:0.0.1`
- **Owner**: `0x44A9Eb810ffAFb611b4a00E6217A87ff3e762ba7`
- **Network**: Arbitrum Sepolia (ChainId: 421614)

Network: Arbitrum One (Chain ID: 42161)

View contracts on Arbiscan:
- [PLSToken](https://arbiscan.io/address/0x39b067f91a3cd342d7055cf832983c1f4e6a9f77)
- [PrivateStaking](https://arbiscan.io/address/0x67ec0d5d810b3e2e402140f90cb8ce3a473baaae)

## Project Structure

```
├── contracts/          # Solidity smart contracts (Arbitrum)
├── iapp/              # iExec iApp for confidential computing
├── frontend/          # React frontend
└── scripts/           # Deployment and utility scripts
```

## Quick Start

### Prerequisites
- Node.js >= 18
- Docker (for iApp testing)
- Foundry (for contracts)
- MetaMask or compatible Web3 wallet

### Installation

```bash
# Clone the repository
git clone https://github.com/Wayleyy/private-liquid-staking.git
cd private-liquid-staking

# Install iExec iApp CLI
npm i -g @iexec/iapp

# Install contract dependencies
cd contracts && forge install

# Install frontend dependencies
cd ../frontend && npm install
```

### Running the Frontend

```bash
cd frontend
npm run dev
```

The frontend will be available at `http://localhost:5173`

### Testing the iApp Locally

```bash
cd iapp
npm install
npm test
```

### How It Works

1. **Stake**: Users stake WETH through the frontend. The stake amount is committed on-chain using a hash, keeping the actual amount private.

2. **Confidential Computation**: The iApp running in iExec's TEE calculates rewards based on the encrypted stake data without revealing individual positions.

3. **Claim Rewards**: Users can claim their rewards using proofs generated by the TEE, verified on-chain without exposing stake amounts.

4. **Unstake**: Unstaking requests are processed confidentially, preventing front-running and whale tracking.

## Documentation

### Technical Documentation
- [iExec TEE Integration](./IEXEC_INTEGRATION.md) - Complete guide to confidential computing integration
- [Account Abstraction](./ACCOUNT_ABSTRACTION.md) - Gasless transactions with Biconomy
- [Bulk Processing](./BULK_PROCESSING.md) - Efficient batch processing with iExec
- [iApp Deployment](./iapp/DEPLOYMENT.md) - Deploy the TEE application
- [Feedback](./feedback.md) - iExec tools feedback for hackathon

### Smart Contracts
- [PrivateStaking.sol](./contracts/src/PrivateStaking.sol) - Main staking contract
- [PLSToken.sol](./contracts/src/PLSToken.sol) - Liquid staking token

### Frontend
- [App.jsx](./frontend/src/App.jsx) - Main React application
- [iExec Integration](./frontend/src/lib/iexec.js) - TEE computation functions
- [Account Abstraction](./frontend/src/lib/accountAbstraction.js) - Gasless transaction functions

## Bonus Prize Eligibility

This project qualifies for **both $300 RLC bonus prizes**:

1. **Account Abstraction**: Implemented gasless transactions using Biconomy SDK
2. **Bulk Processing**: Implemented batch processing for multiple stakes in single TEE task

Total potential bonus: **$600 RLC**

## Links

- [iExec Documentation](https://docs.iex.ec)
- [Hack4Privacy Hackathon](https://dorahacks.io/hackathon/iexec-50partners-hack4privacy)
- [GitHub Repository](https://github.com/Wayleyy/private-liquid-staking)

## License

MIT
